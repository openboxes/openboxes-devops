# Ansible generated this file from {{ template_path }}; do not edit locally!
{# If this comment is present, this is the template file: disregard this warning #}

[client-mariadb]
ssl

[client-server]
{% if remote_webserver is defined %}
port = 3306
{% endif %}
tls_version = TLSv1.1,TLSv1.2,TLSv1.3

[mariadb]

{% if remote_webserver is defined %}
bind-address = {{ ansible_default_ipv4.address | default(ansible_all_ipv4_addresses[0]) }}
{% endif %}

disconnect_on_expired_password = 1
general_log = 0
general_log_file = /var/log/mysql/general.log

{% if mysql_innodb_buffer_pool_size is defined %}
innodb_buffer_pool_size = {{ mysql_innodb_buffer_pool_size }}
{% endif %}

{% if mysql_innodb_use_native_aio is defined %}
innodb_use_native_aio = {{ mysql_innodb_use_native_aio }}
{% endif %}

log_ddl_recovery = /var/log/mysql/ddl_recovery.log
log_error = /var/log/mysql/error.log

{% if mysql_long_query_time is defined %}
long_query_time = {{ mysql_long_query_time }}
{% endif %}

{% if mysql_query_cache_size is defined %}
query_cache_size = {{ mysql_query_cache_size }}
{% endif %}

query_cache_strip_comments = 1

{% if mysql_query_cache_type is defined %}
query_cache_type = {{ mysql_query_cache_type }}
{% endif %}

#
# Ideally, this would be 1, but (a) the Grails 1 branch doesn't work with it,
# and (b) the jury is still out on Rapidi and other finance integrations.
#
require_secure_transport = 0

secure_auth = 1

{% if mysql_slow_query_log is defined %}
slow_query_log = {{ mysql_slow_query_log }}
slow_query_log_file = /var/log/mysql/slow.log
{% endif %}

sql_mode = ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,STRICT_TRANS_TABLES

ssl_ca = /etc/letsencrypt/live/{{ ansible_fqdn }}/fullchain.pem
ssl_cert = /etc/letsencrypt/live/{{ ansible_fqdn }}/cert.pem
ssl_key = /etc/letsencrypt/live/{{ ansible_fqdn }}/privkey.pem
