# Ansible generated this file from {{ template_path }}; do not edit locally!
{# If this comment is present, this is the template file: disregard this warning #}

{% if gpars_poolsize is defined %}
# specify number of GPars workers
export CATALINA_OPTS="$CATALINA_OPTS -Dgpars.poolsize={{ gpars_poolsize }}"
{% endif %}

# tell Tomcat where Ubuntu installs the libtcnative library
export CATALINA_OPTS="$CATALINA_OPTS -Djava.library.path=/usr/lib/x86_64-linux-gnu"

# https://github.com/grails/grails-core/issues/2359
export CATALINA_OPTS="$CATALINA_OPTS -Dstringchararrayaccessor.disabled=true"

# run JVM as a server; don't load AWT libraries
export CATALINA_OPTS="$CATALINA_OPTS -server -Djava.awt.headless=true"

{% if tomcat_xms is defined and tomcat_xmx is defined %}
# set heap size
export CATALINA_OPTS="$CATALINA_OPTS -Xms{{ tomcat_xms }} -Xmx{{ tomcat_xmx }}"
{% endif %}

{% if tomcat_newsize is defined %}
# set size of the "young" generation
export CATALINA_OPTS="$CATALINA_OPTS -XX:NewSize={{ tomcat_newsize }} -XX:MaxNewSize={{ tomcat_newsize }}"
{% endif %}

{% if webserver == "tomcat7" and tomcat_permsize is defined and tomcat_maxpermsize is defined %}
# make space for dynamic (groovy, jsp) classes; not needed in Java 8
export CATALINA_OPTS="$CATALINA_OPTS -XX:PermSize={{ tomcat_permsize }} -XX:MaxPermSize={{ tomcat_maxpermsize }}"
{% endif %}

# configure garbage collection
# https://www.oracle.com/technical-resources/articles/java/g1gc.html
export CATALINA_OPTS="$CATALINA_OPTS -XX:+CMSClassUnloadingEnabled -XX:+DisableExplicitGC -XX:+UseG1GC"
{% if gc_threads is defined %}
export CATALINA_OPTS="$CATALINA_OPTS -XX:ParallelGCThreads={{ gc_threads }}"
{% endif %}
{% if webserver != "tomcat7" %}
export CATALINA_OPTS="$CATALINA_OPTS -XX:+UseStringDeduplication"  # Java 8+
{% endif %}

# https://logging.apache.org/log4j/2.x/security.html
export JAVA_OPTS="$JAVA_OPTS -Dlog4j2.formatMsgNoLookups=true"
export LOG4J_FORMAT_MSG_NO_LOOKUPS=true
